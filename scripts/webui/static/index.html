<!doctype html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Class On 사진 자동 분류</title>
    <link rel="stylesheet" href="./style.css" />
    <script defer src="./app.js"></script>
  </head>
  <body>
    <header class="container hero">
      <div class="brand-badge" aria-label="Classon">CLASS<span>ON</span></div>
      <div class="hero-text">
        <h1 class="title">사진 자동 분류</h1>
      </div>
    </header>

    <main class="container">
      <div id="toast" class="toast" role="status" aria-live="polite" aria-atomic="true" style="display:none"></div>

      <section class="card" aria-label="사진 업로드">
        <div id="dropzone" class="dropzone" tabindex="0" aria-label="여기에 파일을 드래그하거나 클릭하여 선택">
          <div class="dz-icon" aria-hidden="true">📁</div>
          <div class="dz-text">
            사진을 드래그 앤 드롭하거나, 아래 버튼으로 선택하세요.
          </div>
          <input id="fileInput" type="file" accept="image/*" multiple aria-label="사진 파일 선택" />
        </div>
        <div class="actions">
          <button id="chooseBtn" class="btn" type="button">파일 선택</button>
          <button id="uploadBtn" class="btn primary" type="button">업로드 시작</button>
          <span id="fileCount" class="muted" aria-live="polite"></span>
          <button id="purgeAllBtn" class="btn danger" type="button" title="data/input 과 data/output 폴더의 모든 파일 삭제" style="margin-left:auto">이전 사진 삭제</button>
        </div>
        <div class="options">
          <label class="chk"><input id="optLink" type="checkbox" /> 링크로 정리(저장 공간 절약)</label>
          <details>
            <summary>고급 설정</summary>
            <label>업로드 청크 크기(MB) <input id="optChunk" type="number" min="0.25" step="0.25" value="1" /></label>
          </details>
        </div>
      </section>

      <section class="card" aria-label="진행 현황">
        <div class="progress-head">
          <span id="phaseLabel">대기</span>
          <span id="percentLabel">0%</span>
        </div>
        <div class="progress">
          <div id="progressBar" class="progress-bar" style="width: 0%"></div>
        </div>
        <div class="progress-sub" id="countsLabel" aria-live="polite"></div>
      </section>

      <section id="summaryCard" class="card summary-card" aria-label="처리 요약" hidden>
        <div class="summary-header">
          <h2>처리 요약</h2>
          <div style="display:flex; align-items:center; gap:8px;">
            <span id="summaryUpdated" class="summary-note" aria-live="polite"></span>
            <button id="deleteOriginalsBtn" class="btn danger" type="button" title="업로드한 원본 전체 삭제">원본 전체 삭제</button>
          </div>
        </div>
        <div class="summary-grid">
          <div class="stat-tile">
            <span class="label">인물</span>
            <span class="value" id="summaryClustersValue">0</span>
            <span class="hint" id="summaryClustersHint">표시 0명</span>
          </div>
          <div class="stat-tile">
            <span class="label">대표 얼굴</span>
            <span class="value" id="summaryFacesValue">0</span>
            <span class="hint">추천 썸네일 수</span>
          </div>
          <div class="stat-tile">
            <span class="label">원본 사진</span>
            <span class="value" id="summaryPhotosValue">0</span>
            <span class="hint">총 업로드 수</span>
          </div>
          <div class="stat-tile">
            <span class="label">분리되지 않은 사진</span>
            <span class="value" id="summaryUnassignedValue">0</span>
            <span class="hint">확인 필요 항목</span>
          </div>
        </div>
      </section>

      <section id="clusterControls" class="card controls-card" aria-label="인물 보기 설정" hidden>
        <div class="controls-grid">
          <div class="field search-field">
            <label for="clusterSearch">이름 검색</label>
            <input id="clusterSearch" type="search" placeholder="이름을 입력하세요" autocomplete="off" />
          </div>
          <div class="field">
            <label for="clusterSort">정렬</label>
            <select id="clusterSort">
              <option value="faces_desc">사진 많은 순</option>
              <option value="faces_asc">사진 적은 순</option>
              <option value="name_asc">이름 가나다</option>
              <option value="name_desc">이름 역순</option>
            </select>
          </div>
          <div class="field">
            <label for="clusterMin">사진 수</label>
            <select id="clusterMin">
              <option value="0">모두 보기</option>
              <option value="2">2장 이상</option>
              <option value="5">5장 이상</option>
            </select>
          </div>
          <div class="field actions-field">
            <label aria-hidden="true">&nbsp;</label>
            <button id="resetFilters" class="btn" type="button">초기화</button>
          </div>
        </div>
      </section>

      <section id="result" class="result" aria-label="처리 결과" hidden>
        <div class="result-head">
          <h2 class="section-title" id="clustersTitle">인물별 사진</h2>
          <span id="clustersSubhead" class="muted"></span>
        </div>
        <div id="clustersEmpty" class="empty-state" hidden>조건에 맞는 인물이 없습니다. 검색어나 필터를 확인해 주세요.</div>
        <div id="clusters" class="clusters" role="region" aria-live="polite"></div>

        <div class="result-head">
          <h3 class="section-title" id="unassignedTitle">분리되지 않은 사진</h3>
          <span id="unassignedSubhead" class="muted"></span>
        </div>
        <div id="unassignedEmpty" class="empty-state" hidden>모든 사진이 인물에 배정되었습니다.</div>
        <div id="unassigned" class="grid" role="region" aria-live="polite"></div>
      </section>
    </main>



    <!-- 이미지 미리보기 모달 -->
    <div id="imgModal" class="modal" aria-hidden="true" role="dialog" aria-label="이미지 미리보기">
      <div class="modal-dialog">
        <button id="modalClose" class="modal-close" aria-label="닫기">×</button>
        <button id="modalPrev" class="modal-nav prev" aria-label="이전" title="이전">‹</button>
        <button id="modalNext" class="modal-nav next" aria-label="다음" title="다음">›</button>
        <img id="modalImg" alt="미리보기" />
        <div id="modalCaption" class="modal-caption" aria-live="polite"></div>
        <div class="modal-actions"><a id="modalOpenNew" href="#" target="_blank" rel="noopener">새 탭에서 열기</a></div>
      </div>
    </div>

    <!-- 삭제 확인 모달 -->
    <div id="confirmModal" class="modal" aria-hidden="true" role="dialog" aria-label="삭제 확인">
      <div class="modal-dialog">
        <div class="card" style="min-width: 280px; max-width: 420px;">
          <div id="confirmMsg" class="mb-2">이 사진을 삭제할까요?</div>
          <div class="modal-actions" style="display:flex; gap:8px; justify-content:flex-end;">
            <button id="confirmNo" class="btn">취소</button>
            <button id="confirmYes" class="btn danger">삭제</button>
          </div>
        </div>
      </div>
    </div>
  </body>
  </html>
